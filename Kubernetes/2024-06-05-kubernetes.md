# 2024-06-05: Kubernetes 기본 개념

Kubernetes는 컨테이너화된 애플리케이션의 배포, 확장 및 관리를 자동화하는 오픈 소스 시스템입니다. Google에서 개발한 후 Cloud Native Computing Foundation(CNCF)으로 이관되었습니다. Kubernetes는 대규모 애플리케이션을 효율적으로 운영할 수 있게 해주는 중요한 도구입니다.

## Kubernetes

- **목적**: 애플리케이션의 배포, 확장 및 관리를 자동화하여 운영 효율성을 높이고, 일관된 환경을 제공합니다.
- **구성 요소**: 클러스터, 노드, 파드, 서비스, 배포, 컨트롤러 등이 포함됩니다.
- **도구**: kubectl, Helm, Kustomize 등 다양한 도구들이 사용됩니다.

## 주요 개념

1. **클러스터**: Kubernetes 클러스터는 하나 이상의 마스터 노드와 여러 워커 노드로 구성됩니다. 마스터 노드는 클러스터를 관리하고, 워커 노드는 컨테이너화된 애플리케이션을 실행합니다.
    - **마스터 노드**: 클러스터의 상태를 관리하고, 스케줄링, 컨트롤러 매니저, API 서버 등을 포함합니다.
    - **워커 노드**: 애플리케이션 컨테이너가 실행되는 노드입니다.

2. **노드**: 노드는 클러스터 내에서 컨테이너를 실행하는 물리적 또는 가상 서버입니다. 각 노드는 kubelet, kube-proxy, 컨테이너 런타임 등을 포함합니다.

3. **파드(Pod)**: 파드는 Kubernetes에서 배포할 수 있는 가장 작은 단위로, 하나 이상의 컨테이너로 구성됩니다. 동일한 네임스페이스와 스토리지 볼륨을 공유하며, 일반적으로 같은 애플리케이션의 컨테이너를 그룹화합니다.
    - **단일 컨테이너 파드**: 하나의 컨테이너만 포함하는 파드입니다.
    - **멀티 컨테이너 파드**: 여러 컨테이너를 포함하며, 컨테이너 간에 자원을 공유합니다.

4. **서비스(Service)**: 서비스는 파드의 집합에 대해 네트워크 접근을 제공하는 추상화 레이어입니다. 로드 밸런싱과 서비스 디스커버리를 지원합니다.
    - **클러스터IP**: 클러스터 내부에서만 접근 가능한 가상 IP를 제공합니다.
    - **노드포트**: 각 노드에서 특정 포트로 접근할 수 있도록 합니다.
    - **로드밸런서**: 외부 로드 밸런서를 통해 접근할 수 있도록 합니다.

5. **배포(Deployment)**: 배포는 파드를 선언적으로 업데이트하는 방법을 제공합니다. 정의된 상태를 유지하기 위해 새로운 파드를 생성하고, 기존 파드를 교체하거나 삭제합니다.
    - **롤링 업데이트**: 점진적으로 업데이트를 수행하여 무중단 배포를 가능하게 합니다.
    - **롤백**: 문제가 발생했을 때 이전 상태로 되돌릴 수 있습니다.

6. **컨트롤러(Controller)**: 컨트롤러는 클러스터 상태를 원하는 상태로 유지하기 위해 작동하는 루프입니다. 레플리카셋, 스테이트풀셋, 데몬셋 등이 있습니다.
    - **레플리카셋(ReplicaSet)**: 특정 수의 파드가 항상 실행되도록 보장합니다.
    - **스테이트풀셋(StatefulSet)**: 상태가 필요한 애플리케이션을 관리합니다.
    - **데몬셋(DaemonSet)**: 모든 노드에서 단일 파드를 실행합니다.

## 주의사항

- **리소스 관리**: 적절한 리소스 할당과 제한을 통해 클러스터 자원을 효율적으로 관리해야 합니다.
- **보안**: RBAC(Role-Based Access Control), 네트워크 폴리시 등을 통해 클러스터와 애플리케이션의 보안을 강화해야 합니다.
- **모니터링**: Prometheus, Grafana 등을 사용하여 클러스터와 애플리케이션의 상태를 모니터링하고, 문제를 사전에 발견해야 합니다.

## 예시

### 간단한 Nginx 배포 예제

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx-deployment
  labels:
    app: nginx
spec:
  replicas: 3
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - name: nginx
        image: nginx:1.14.2
        ports:
        - containerPort: 80
```
위 예제는 Nginx 서버를 3개의 복제본으로 배포하는 Kubernetes 배포 설정입니다.

## 요약
- **Kubernetes**: 컨테이너화된 애플리케이션의 배포, 확장, 관리를 자동화하여 운영 효율성을 높이고 일관된 환경을 제공합니다.
- **주의사항**: 적절한 리소스 관리, 보안 강화, 모니터링이 중요합니다.
- **예시**: Nginx 서버를 Kubernetes를 통해 배포할 수 있습니다.
